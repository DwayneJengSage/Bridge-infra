#This template is used to bootstrap resources for an AWS account.
#The resources in this template only need to be created once.
#
#Usage:
#  aws --profile bridge.admin --region us-east-1 \
#  cloudformation create-stack \
#  --stack-name bootstrap \
#  --on-failure DELETE \
#  --capabilities CAPABILITY_NAMED_IAM \
#  --template-body file://cf_templates/bootstrap.yml
Description: Bootstrap resources for AWS account
AWSTemplateFormatVersion: 2010-09-09
Outputs:
  # !! IMPORTANT !! - AWS API will refuse to remove users that have attached resources.
  # Therefore you must do the following before deleting them from this file:
  # 1. Detach or remove the following user resources: login profile, attached
  #    MFA device, access-keys, ssh-keys, and policies.
  # 2. Detach the user from all groups.
  AWSIAMTravisUser:
    Value: !Ref AWSIAMTravisUser
    Export:
      Name: !Sub '${AWS::StackName}-TravisUser'
  AWSIAMTravisUserAccessKey:
    Value: !Ref AWSIAMTravisUserAccessKey
    Export:
      Name: !Sub '${AWS::StackName}-TravisUserAccessKey'
Resources:
  AWSIAMTravisUserAccessKey:
    Type: 'AWS::IAM::AccessKey'
    Properties:
      UserName: !Ref AWSIAMTravisUser
  AWSIAMTravisUser:
    Type: 'AWS::IAM::User'
    Properties:
      Groups:
        - !Ref AWSIAMCiGroup
  AWSIAMCiGroup:
    Type: 'AWS::IAM::Group'
    Properties:
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/AdministratorAccess
